"use strict";__filename="pages/options_defs.js",define(["require","exports","./async_bg","./options_base"],function(t,i,n,s){var r,e,u,h,o,f,a,c,l,d,v,p,g;Object.defineProperty(i,"__esModule",{value:true}),i.onKeyMappingsError=i.createNewOption=i.registerClass=i.savedStatus=i.exportBtn=i.saveBtn=i.xt=i.Nt=i.Tt=i.Ot=i.Vt=i.Et=void 0,s.s.i=Object.create(null),s.s.I=[],s.s.prototype.P=function(t){var i,r;t.call(this),VApi&&(i=s.r.b[this.x],r=this.F(),n.m(3,{key:i,val:r}).then(function(t){VApi.z[i]=null!=t?t:r,"a"!==i&&"l"!==i||n.m(29,{key:i,val:null!=t?t:r})}))},s.s.prototype.z=function(t){var i,s;t.call(this),i=this.F(),"autoReduceMotion"===this.x?(s=1===i||0!==i&&matchMedia("(prefers-reduced-motion: reduce)").matches,VApi&&(VApi.z.m=s),n.toggleReduceMotion(s)):this.M()},s.s.At=function(){return __awaiter(this,void 0,void 0,function*(){var t,i,r,e,u,h,o=s.s.i,f=[];for(r in s.r.d(),i=(t=o.optionalPermissions)&&t.E(),yield Promise.all([s.r.v(),i]),o)!(e=o[r]).O&&e.B()&&f.push(e.Ft());if(f.length>0&&!confirm(s.t("dirtyOptions",[f.join("\n  * ")])))return false;for(r in o)if(!(e=o[r]).O&&!e.A())return false;for(r in n.y(8),o.vimSync.O||(yield o.vimSync.E()),o.exclusionRules.O||(yield o.exclusionRules.E()),u=[],o)(h=o[r]).O||u.push(h.E());return yield Promise.all(u),n.y(0,8),true})},s.s.Bt=function(){var t,i=s.s.i;for(t in i)if(!i[t].O)return true;return false},s.s.prototype.Ft=function(){var t=this.S;return this instanceof e?t.nextElementSibling.textContent:(t=(t=t.closest("tr")).querySelector(".caption")).innerText.replace(/[\r\n]/g,"")},s.s.prototype.G=function(t,i){return t===i},r=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.J=function(){var t,n,r=this;this.H={min:(t=this.S.min)&&!isNaN(n=parseFloat(t))?n:null,max:(t=this.S.max)&&!isNaN(n=parseFloat(t))?n:null,default:0,L:i.Jt},this.S.oninput=this.N,this.S.onfocus=this.Rt.bind(this),s.r.v().then(function(){r.H.default=s.r.p[r.x]})},i.prototype.j=function(t){this.S.value=""+t},i.prototype.F=function(){return parseFloat(this.S.value)},i.prototype.Rt=function(){var t=this,i=this.S,n=function(i){return t.jt(i)},s=function(){i.removeEventListener("wheel",n,{passive:false}),i.removeEventListener("blur",s),t.Ht=0};this.Ht=0,i.addEventListener("wheel",n,{passive:false}),i.addEventListener("blur",s)},i.prototype.jt=function(t){var i,n,s,r,e,u,h,o;if(t.preventDefault(),i=this.Ht,!((n=Date.now())-i<100&&n+99>i&&i))return this.Ht=n,e=(s=this.S).value,"function"==typeof(h=(r=(t.deltaY||t.deltaX)>0)?s.stepUp:s.stepDown)?(h.call(s),u=s.value,s.value=e):(o=(h=parseFloat)(s.step)||1,n=(+s.value||0)+(r?o:-o),isNaN(o=h(s.max))||(n=Math.min(n,o)),isNaN(o=h(s.min))||(n=Math.max(n,o)),u=""+n),this.Lt(u,i>0,false)},i.Jt=function(t){return isNaN(t)&&(t=this.default),t=null!=this.min?Math.max(this.min,t):t,null!=this.max?Math.min(this.max,t):t},i})(s.s),i.Et=r,e=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.J=function(){var t=this.S,n=t.dataset.map;this.Pt=n?JSON.parse(n):t.dataset.allowNull?i.Ut:i.Dt,this.qt=this.Pt.length-1,this.qt>1&&"vimSync"!==this.x&&t.addEventListener("change",this.onTripleStatusesClicked.bind(this),true),t.onchange=this.N},i.prototype.j=function(t){var i=true===t||t===this.Pt[this.qt];this.S.checked=i,this.S.indeterminate=this.qt>1&&t===this.Pt[1],this.Ct=i?this.qt:Math.max(0,this.Pt.indexOf(t))},i.prototype.F=function(){return this.S.indeterminate?this.Pt[1]:this.Pt[this.S.checked?this.qt:0]},i.prototype.onTripleStatusesClicked=function(t){t.preventDefault();var i=this.Ct;this.Ct=2===i?1:i?0:2,this.S.indeterminate=2===i,this.S.checked=2===this.Ct},i.prototype.D=function(t){return this.S.dataset.map&&"boolean"==typeof t&&(t=this.Pt[t?this.qt:0]),t},i.Dt=[false,true],i.Ut=[false,null,true],i})(s.s),i.Vt=e,u=(function(t){function i(){var i=null!==t&&t.apply(this,arguments)||this;return i.It=false,i}return __extends(i,t),i.prototype.J=function(){var t=this.S.dataset.converter||"",n=t?t.split(" "):[];this.S.oninput=this.N,n.length>0&&(this.H={Gt:n,$:0,L:i.Kt})},i.prototype.R=function(){var i=this,n=t.prototype.R.call(this),s=this.H;return s&&(s.$=0,n?n=n.then(function(){s.$=s.L(i.w)===i.w?1:0}):s.$=s.L(this.w)===this.w?1:0),n},i.prototype.j=function(t,i){var n=this.Qt(t);true!==i?this.S.value=n:this.Lt(n,true,true)},i.prototype.Wt=function(){return this.S.value.trim().replace(/\xa0/g," ")},i.prototype.Qt=function(t){return t},i.prototype.F=function(){var t=this.Wt(),n=this.H;return t&&n&&n.L===i.Kt&&(n.$|=2,t=i.Kt.call(n,t),n.$&=-3),t},i.prototype.q=function(t){return this.Qt(t)!==this.Wt()},i.prototype.zt=function(t,n){var s=!!t;(s||this.It)&&(this.It=s,i.zt(t,n,this.S))},i.zt=function(t,i,s){var r=!!t,e=s.classList,u=s.parentElement,h=s.nextElementSibling;h=h&&h.classList.contains("tip")?h:null,(r||h)&&n.K(function(){r?(null==h&&((h=document.createElement("div")).className="tip",u.insertBefore(h,s.nextElementSibling)),h.textContent=t,null!==i&&e.add(i||"has-error")):(e.remove("has-error"),e.remove("highlight"),h&&h.remove())})},i.Kt=function(t){var i,n,s=this.Gt;if(s.indexOf("lower")>=0?t=t.toUpperCase().toLowerCase():s.indexOf("upper")>=0&&(t=t.toLowerCase().toUpperCase()),t=t.normalize(),s.indexOf("chars")<0||2&this.$&&!(1&this.$))return t;for(n of(i="",t.replace(/\s/g,"")))i.includes(n)||(i+=n);return i},i})(s.s),i.Ot=u,h=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.F=function(){var i=t.prototype.F.call(this);return i||this.j(i=s.r.p[this.x],true),i},i})(u),i.Tt=h,o=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.Qt=function(t){var i=this.S instanceof HTMLInputElement,n=JSON.stringify(t,null,i?1:2);return i?n.replace(/(,?)\n\s*/g,function(t,i){return i?", ":""}):n},i.prototype.F=function(){var i=t.prototype.F.call(this),n=null;if(i)try{n=JSON.parse(i)}catch(t){}else this.j(n=s.r.p[this.x],true);return n},i})(u),i.Nt=o,f=(function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.J=function(){t.prototype.J.call(this),this.Xt=true,this.Yt=this.Zt.bind(this),this.S.addEventListener("focus",this.Yt)},i.prototype.Zt=function(){this.Yt&&(this.S.removeEventListener("focus",this.Yt),this.S.classList.remove("masked"),this.Yt=null,this.Xt=false,this.S.removeAttribute("placeholder"),this.R())},i.prototype.j=function(i,n){this.Xt?this.S.placeholder=s.t("clickToUnmask"):t.prototype.j.call(this,i,n)},i.prototype.Wt=function(){return this.Xt?this.w:t.prototype.Wt.call(this)},i})(u),i.xt=f,u.prototype.Lt=r.prototype.Lt=function(t,i,n){var s,r,e,u,h,o,f,a,c,l,d,v=this.S,p=v.value,g="backward"!==v.selectionDirection?v.selectionEnd:v.selectionStart,m=false;for(i&&(this.$t=true,(m=document.activeElement!==v)&&v.focus(),document.execCommand("undo")),this.$t=n,r=v.scrollLeft,e=v.scrollTop,u=0,h=(s=i?v.value:p).length-1,o=t.length-1,f=Math.min(h,o);u<=f&&s[u]===t[u];)u++;for(f=Math.max(u,h-(o-u));f<=h&&s[h]===t[o];)h--,o--;if(v.setSelectionRange(u,h+1),a=t.slice(u,o+1),document.execCommand("insertText",false,a),m&&this.S.blur(),p!==s){for(u=0,h=p.length-1,o=t.length-1,f=Math.min(h,o);u<=f&&p[u]===t[u];)u++;for(f=Math.max(u,h-(o-u));f<=h&&p[h]===t[o];)h--,o--}g?g===p.length?(r=v.scrollWidth,e=v.scrollHeight,g=t.length):g<u||(g>h?g+=o-h:(l=(c=p.slice(0,g).split("\n")).length,(d=t.split("\n").slice(0,l)).length===l&&(d[l-1]=d[l-1].slice(0,c[l-1].length)),g=d.reduce(function(t,i){return t+i.length},0)+d.length-1)):r=e=0,v.scrollTo(r,e),v.setSelectionRange(g,g),this.$t=false},o.prototype.G=s.s.Q,s.e.prototype.nt=function(t){var i,r,e,u,h;if(this.W.length===t)for(e of(i=n.$("#exclusionToolbar"),r=n.$$("[data-model]",i),i.style.visibility=t?"":"hidden",r))(h=(u=s.s.i[e.id]).S.parentNode.style).visibility=t||u.O?"":"visible",h.display=!t&&u.O?"none":""},i.saveBtn=n.$("#saveOptions"),i.exportBtn=n.$("#exportButton"),i.createNewOption=(function(){var t,a,c,l,d=false;for(l of(i.savedStatus=function(t){return d=null!=t?t:d},t=function(){this.$t||((this.O=this.G(this.F(),this.w))?d&&!s.s.Bt()&&(i.saveBtn.disabled=true,i.saveBtn.firstChild.data=s.t("115"),i.exportBtn.disabled=false,i.savedStatus(false),window.onbeforeunload=null):d||(window.onbeforeunload=function(){return s.t("beforeUnload")},i.savedStatus(true),i.saveBtn.disabled=false,i.saveBtn.firstChild.data=s.t("115_2"),i.exportBtn.disabled=true))},a={Number:r,Boolean:e,Text:u,NonEmptyText:h,JSON:o,MaskedText:f,ExclusionRules:s.e},c=function(i){var n=new(0,a[i.dataset.model])(i,t);return s.s.i[n.x]=n},s.s.T=true,n.$$("[data-model]")))c(l);return i.registerClass=function(t,i){a[t]=i},c})(),(c=(a=s.s.i.exclusionRules).V).ondragstart=function(t){(a.ti=t.target).style.opacity="0.5"},c.ondragend=function(){var t=a.ti;a.ti=null,t&&(t.style.opacity="")},c.ondragover=function(t){t.preventDefault()},c.ondrop=function(t){var i,n,s,r,e;t.preventDefault(),i=a.ti,n=(n=t.target).closest(".exclusionRule"),i&&n&&i!==n&&(a.V.insertBefore(i,n),s=a.W,r=i.querySelector(".pattern").vnode,e=n.querySelector(".pattern").vnode,s.splice(s.indexOf(r),1),s.splice(s.indexOf(e),0,r),a.N())};d=function(t){for(var i,n,s=new RegExp("^".concat("#").concat("!","[^\\n]*|^[^]"),"gm");i=s.exec(t);)if((n=i[0])&&"\n"!==n[0]){if("#"!==n[0])break;if("!"===n[1]&&"no-check"===n.slice(2).trim()){t=t.slice(0,i.index)+t.slice(i.index+n.length).trimLeft();break}}return t.replace(/\.activateMode(?:To)?/g,".activate")},(l=s.s.i.keyMappings).C=function(){var t=s.s.prototype.C.call(this);return t instanceof Promise?t.then(d):d(t)},l.D=function(t){return t=d(t),s.s.prototype.D.call(this,t)},i.onKeyMappingsError=function(t){true===t?l.zt(s.t("ignoredNonEN"),null):l.zt(t)},n.m(7).then(i.onKeyMappingsError),g=s.s.i.filterLinkHints,(v=s.s.i.linkHintCharacters).M=(p=s.s.i.linkHintNumbers).M=function(){this.zt(!this.S.style.display&&this.w.length<4?"Too few characters for LinkHints":"")},g.M=function(){n.K(function(t){var i=g.F();t.style.display=p.S.style.display=i?"":"none",v.S.style.display=i?"none":"",v.M(),p.M()},n.$("#waitForEnterBox"))},s.s.i.ignoreKeyboardLayout.M=function(){var t=this;n.K(function(i){i.style.display=t.F()>1?"none":""},n.$("#ignoreCapsLockBox"))},s.s.i.vomnibarPage.M=function(){var t=this.S,i=this.w,r=i.startsWith(location.protocol)||i.startsWith("front/");if(n.vt<50)return n.K(function(){t.style.textDecoration=r?"":"line-through"}),this.zt(i===s.r.p.vomnibarPage?"":s.t("onlyExtVomnibar",[50]),null);r?this.zt(""):i.startsWith("file:")?this.zt(s.t("fileVomnibar"),"highlight"):/^http:\/\/(?!localhost[:/])/i.test(i)?this.zt(s.t("httpVomnibar"),"highlight"):this.zt("")},s.s.i.userDefinedCss.M=function(){var t=this;this.S.classList.contains("debugging")&&n.K(function(){var i,s,r,e=VApi.y().r;for(i of n.$$("iframe",e))s=i.classList.contains("HUD"),(r=i.contentDocument.querySelector("style.debugged"))&&(s?r.remove():r.classList.remove("debugged"));t.S.classList.remove("debugging")})},s.s.i.autoReduceMotion.M=function(){var t=this;n.K(function(){var i=t.w;n.toggleReduceMotion(2===i?matchMedia("(prefers-reduced-motion: reduce)").matches:i>0)})},s.s.i.passEsc.F=function(){return h.prototype.F.call(this).replace(/, /g,",")},s.s.i.passEsc.Qt=function(t){return t.replace(/,/g,", ")}});