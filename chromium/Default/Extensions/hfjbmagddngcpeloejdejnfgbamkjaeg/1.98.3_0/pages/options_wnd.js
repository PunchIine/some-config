"use strict";__filename="pages/options_wnd.js",define(["require","exports","./async_bg","./options_base","./options_defs","./options_permissions"],function(n,t,e,i,o,u){var r,a,c,f,s;Object.defineProperty(t,"__esModule",{value:true}),t.loadChecker=t.clear_delayed_task=t.advancedOptBtn=t.delayed_task=void 0,t.advancedOptBtn=e.$("#advancedOptionsButton"),r=false,a=function(){t.delayed_task=null},t.clear_delayed_task=a,e.y(8),e.K(i.showI18n),i.n&&e.K(i.n),e.K(function(n){n.textContent=u.manifest.version_name||u.manifest.version},e.$(".version")),o.saveBtn.onclick=function(n){if(false===n){var t=i.s.I;i.s.I=[],o.saveBtn.disabled=true,o.saveBtn.firstChild.data=i.t("115_3"),o.exportBtn.disabled=false,o.savedStatus(false),window.onbeforeunload=null,window.addEventListener("beforeunload",c,true),0!==t.length&&setTimeout(function(n){e.m(4,n.map(function(n){return i.r.b[n]}))},100,t)}else i.s.At().then(function(n){n&&o.saveBtn.onclick(false)})},c=function(){e.m(30)},f=function(){var n,a,c,f,s,l,d;for(c in t.advancedOptBtn.onclick=function(n,t){var o=this,u=e.$("#advancedOptions"),a=null,c=function(){return a=i.r.g("showAdvancedOptions")};null!=n||"hash"===t&&false===c()?i.r.k("showAdvancedOptions",r=!r):r=null!=a?a:c(),e.K(function(){u.previousElementSibling.style.display=u.style.display=r?"":"none";var n=r?"Hide":"Show";o.firstChild.data=i.t(n)||n,o.setAttribute("aria-checked",""+r)},9)},t.advancedOptBtn.onclick(null,true),i.s.T=false,i.s.i)i.s.i[c].R();for(i.s.i.exclusionRules.w.length>0&&e.K(function(n){n.style.visibility=""},e.$("#exclusionToolbar")),f=(a=e.$$("[data-check]")).length;0<=--f;)(n=a[f]).addEventListener(n.dataset.check||"input",t.loadChecker);for(document.addEventListener("keyup",function(n){var t=n.target,i=n.keyCode;if(13===i){if(t instanceof HTMLAnchorElement)t.hasAttribute("href")||setTimeout(function(n){e.simulateClick(n),n.blur()},0,t);else if((n.ctrlKey||n.metaKey)&&(t.blur&&t.blur(),o.savedStatus()))return o.saveBtn.onclick()}else{if(32!==i)return;t instanceof HTMLSpanElement&&t.parentElement instanceof HTMLLabelElement&&(n.preventDefault(),e.simulateClick(t.parentElement.control))}}),s=function(){var n,t,i=e.$("#"+this.dataset.autoResize),o=i.scrollHeight,u=i.scrollWidth,r=u-i.clientWidth;o<=i.clientHeight&&r<=0||(n=Math.max(Math.min(innerWidth,1024)-120,550),i.style.maxWidth=u>n?n+"px":"",i.style.height=i.style.width="",t=i.offsetHeight-i.clientHeight,o+=t=(r=u-i.clientWidth)>0?Math.max(26,t):t+18,r>0&&(i.style.width=i.offsetWidth+r+4+"px"),i.style.height=o+"px")},f=(a=e.$$("[data-auto-resize]")).length;0<=--f;)a[f].onclick=s;for(s=function(n){var i=this.dataset.delay,o=null;"continue"!==i&&n&&n.preventDefault(),"event"===i&&(o=n||null),t.delayed_task=["#"+this.id,o],"complete"!==document.readyState?window.addEventListener("load",function n(t){t.target===document&&(window.removeEventListener("load",n),e.import2("./options_ext.js"))}):e.import2("./options_ext.js")},f=(a=e.$$("[data-delay]")).length;0<=--f;)a[f].onclick=s;if(e.vt<53)for(s=function(n){n.target===this&&(n.preventDefault(),getSelection().selectAllChildren(this))},f=(a=e.$$(".sel-all")).length;0<=--f;)a[f].onmousedown=s;for((a=e.$$("[data-permission]")).length>0&&(function(n){function t(){var n,t=this.querySelector("[data-permission]");this.onclick=null,t&&(t.placeholder=i.t("lackPermission",[(n=t.dataset.permission)?': "'.concat(n,'"'):""]))}var o,r=u.manifest.permissions||[],a=function(o){var a,c,f=n[o],s=f.dataset.permission;if("C"===s[0]){if(e.vt>=parseInt(s.slice(1)))return"continue";if("."===(c=s.split(",",2)[1]||",")[0]?null!=window[c.slice(1)]:"("===c[0]&&matchMedia(c.slice(1,-1)))return"continue";a=["beforeChromium",[s.slice(1).split(",",1)[0]]]}else{if(s in u.manifest||r.includes(s))return"continue";a=["lackPermission",[s?":\n* "+s:""]]}e.K(function(n){n.disabled=true;var e=i.t("invalidOption",[i.t(a[0],a[1])]);n instanceof HTMLInputElement&&"checkbox"===n.type?(n.nextElementSibling.tabIndex=-1,(n=n.parentElement).title=e):(n.value="",n.title=e,n.parentElement.onclick=t,n instanceof HTMLSpanElement&&(n.style.textDecoration="line-through"))},f)};for(o=n.length;0<=--o;)a(o)})(a),e.K(function(){setTimeout(function(){var n,t=e.$$("[data-href]"),i=function(n){var i=t[n];e.m(10,[i.dataset.href,-1]).then(function(n){var t=n[0];i.removeAttribute("data-href"),i.href=t})};for(n=t.length;0<=--n;)i(n);e.m(12).then(function(n){"?"!==n&&e.K(function(n){return n[0].textContent=n[1]},[e.$("#questionShortcut"),n])})},100)}),n=e.$("#openExtensionsPage"),e.vt<65&&e.K(function(n){n.href="chrome://extensions/configureCommands"},n),n.onclick=function(n){n.preventDefault(),e.m(15,{u:this.href,p:true})},e.K(function(n){var t=n.children[1],e=i.t("NewTabAdapter");t.title=e+" - "+i.t("webstore")},e.$("#chromeExtVomnibar")),a=e.$$(".ref-text"),l=function(n){r||e.$("#advancedOptionsButton").onclick(null),n.preventDefault();var t=i.s.i[this.getAttribute("for")].S.nextElementSibling;e.vt<61?t.scrollIntoViewIfNeeded():t.scrollIntoView({block:"center"}),t.focus(),VApi&&VApi.x(t.parentElement.parentElement)},d=function(n){var t=i.s.i[a[n].getAttribute("for")],o=t.M;t.M=function(){return e.K(function(n){n.textContent=i.t(t.F()>1?"145_2":"144")},e.$("#".concat(t.S.id,"Status"))),o.call(t)},a[n].onclick=l,t.S.addEventListener("change",t.M,true)},f=a.length;0<=--f;)d(f)},s=function(){var n,t,u,r,a;for(n in f(),f=s=null,i.r.l||e.K(function(n){n.textContent="Cmd"},e.$("#Ctrl")),i.s.i)i.s.i[n].M();e.K(function(){document.documentElement.classList.remove("loading")}),e.nn.then(e.an),location.hash&&e.K(window.onhashchange),e.y(0,8),i.s.i.keyMappings.M=function(){return e.m(7).then(o.onKeyMappingsError)},t=matchMedia("(prefers-color-scheme: dark)"),u=function(){r.O&&e.m(11),setTimeout(a,34)},a=function(){var n,i,o,u,a,c,f=r.F(),s=2===f?!!t&&t.matches:1===f;if(VApi&&VApi.z){if(n=VApi.y().r)for(i of e.vt<51?[].slice.call(n.children):n.children)"style"!==i.localName&&(i.classList.toggle("D",s),"iframe"===(i=i.firstElementChild||i).localName&&(o=i.classList.contains("Find"),(a=(u=i.contentDocument).querySelector("style#dark"))&&a.sheet&&(a.sheet.disabled=!s),u.body.classList.toggle(o?"D":"has-dark",s),o&&(c=VApi.y().f)&&c.parentElement.classList.toggle("D",s)));e.m(3,{key:"d",val:s}).then(function(n){VApi.z.d=n})}e.toggleDark(s?2===f?2:1:0)},(r=i.s.i.autoDarkMode).M=u,e.vt>75?e.K(function(){2===r.w&&e.nn.then(u),t.onchange=u}):t=null},i.s.i.userDefinedCss.S.addEventListener("input",i.h(function(){var n,t,o,u,r,a=i.s.i.userDefinedCss,c=a.S.classList.contains("debugging");(!a.O||c)&&VApi&&VApi.z&&(n=a.F(),t=n===a.w,o=e.m(8,[n,e.ln]),u=VApi.y(),r=u.r,o.then(function(n){var e,o,u;a.S.classList.toggle("debugging",!t),VApi.t({k:r||t?0:1,t:i.t("livePreview")||"Live preview CSS\u2026",H:n.ui,f:n.find}),(o=(e=r&&r.querySelector("iframe.Omnibar"))&&e.contentDocument)&&((u=o.querySelector("style.debugged")||o.querySelector("style#custom"))||((u=o.createElement("style")).type="text/css",u.id="custom"),u.parentNode||o.head.appendChild(u),u.classList.add("debugged"),u.textContent=(t?"\n":"\n.transparent { opacity: 1; }\n")+(n.omni&&n.omni+"\n"||""))}))},1200,null,0)),e.$("#importButton").onclick=function(){var n=e.$("#importOptions");n.onchange?n.onchange(null):e.simulateClick(e.$("#settingsFile"))},e.K(function(n){var t,o,u,r,a,c=i.r.f,f=e.dn,s=e.vt;f||(u=(o=((t=navigator.userAgentData)&&(t.brands||t.uaList)||[]).filter(function(n){return(n.version===e.vt&&"Chromium"!==n.brand||n.brand.includes("Opera"))&&!" ".concat(n.brand," ").includes(" Not ")})).find(function(n){return/\b(Edge|Opera)\b/.test(n.brand)})||o[0],r=e.sn?"MS Edge":"",f=u?u.brand:t?r||"Chromium":(/\bChromium\b/.exec(navigator.userAgent)||[""])[0]||r||"Chrome",u&&(s=u.version)),n.textContent=f+" "+s+i.t("comma")+i.t("NS")+(i.t(c)||c[0].toUpperCase()+c.slice(1)),e.sn&&((a=e.$("#openExtensionsPage")).textContent=a.href="edge://extensions/shortcuts")},e.$("#browserName")),t.loadChecker=function(){e.import2("./options_checker.js")},document.addEventListener("keydown",function(n){var t,i,o,u,r;if(32===n.keyCode)"span"===(r=n.target).localName&&"label"===r.parentElement.localName&&n.preventDefault();else{if(!VApi||!VApi.z||"input textarea".includes(document.activeElement.localName))return;"a-f12"===(t=VApi.r[3]({c:" ",e:n,i:n.keyCode,v:""},10))?(i=e.$("#importOptions"),o=i.selectedIndex,u=function(){i.onchange&&i.onchange(null),i.selectedIndex=o},e.$("#recommendedSettings").selected=true,null!=i.onchange?u():setTimeout(u,100)&&i.click()):"?"===t&&e.$("#showCommands").click()}}),window.onhashchange=function(){var n,t,i=location.hash;if((i=i.slice("!"===i[1]?2:1))&&/^[a-z][a-z\d_-]*$/i.test(i))if(n=e.$('[data-hash="'.concat(i,'"]')))n.onclick&&n.onclick(null,"hash");else if(n=e.$("#"+i)){if(n.dataset.model&&n.classList.add("highlight"),t=function(t){t&&t.target!==window||(window.onload&&(window.onload=null,window.scrollTo(0,0)),n.scrollIntoViewIfNeeded())},"complete"===document.readyState)return t();window.scrollTo(0,0),window.onload=t}},i.r.v().then(s),document.addEventListener("click",function n(){var t=VApi,i=t&&t.y();i&&i.r&&(document.removeEventListener("click",n,true),i.r.addEventListener("click",function(n){var t,e=n.target;VApi&&e.classList.contains("HelpCommandName")&&(t=e.textContent.slice(1,-1),VApi.p({H:17,s:t}))},true),document.addEventListener("click",function(n){var t,i,o,u;"a"!==n.target.localName||!n.ctrlKey&&!n.metaKey||e.ln<-1||(o=(i=(t=VApi)&&t.b)&&i.$())&&o.a&&o.k&&null===o.k.c&&(u=-17&o.m)<32&&2&u&&!(1&u)&&setTimeout(function(){e.ln>=0&&(e.Mt.tabs?e.Mt.tabs.update(e.ln,{active:true},function(){}):e.m(25,{module:"tabs",name:"update",args:[e.ln,{active:true}]}))},0)}))},true)});