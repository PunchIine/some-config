"use strict";__filename="pages/options_base.js",define(["require","exports","./async_bg"],function(t,i,n){var e,s,r,u,o;Object.defineProperty(i,"__esModule",{value:true}),i.t=i.n=i.e=i.s=i.r=i.u=i.o=i.h=i.showI18n=void 0,e=function(){var t,e,s,r,u,o;if("en"!==n.a){if(t=n.a.split(",")[0],e=navigator.language||t,(r=(s=n.$("#keyMappings"))&&i.t("keyMappingsP"))&&(s.placeholder=r),e&&(!t.startsWith("zh")||"zh-CN"!==e))for(s of n.$$("input[type=text], textarea"))s.lang=e;for(s of n.$$("[data-i]"))o=(u=s.dataset.i).endsWith("-t"),null!=(r=n.c(o?u.slice(0,-2):u))&&(o?s.title=r:s.textContent=r);document.documentElement.lang="zh"===t?"zh-CN":t}},i.showI18n=e,window.__extends=function(t,i){var n=function(){this.constructor=t};n.prototype=i.prototype,t.prototype=new n},i.h=function(t,i,n,e){var s,r=0,u=function(){var o=Date.now()-s;if(!(o<i-4&&o>=0))return r=0,s!==e?t.call(n):void 0;r=setTimeout(u,i-o)};return e=e?1:0,function(){if(s=Date.now(),!r)return r=setTimeout(u,i),e?(e=s,t.call(n)):void 0}},s=null,i.o=function(t){s=t},i.u=function(){return s},i.r={f:"",l:9,p:null,d:function(){s=null},v:function(){return s?s instanceof Promise?s:Promise.resolve():(i.r.p||n.m(0).then(function(t){i.r.p=t[0],i.r.l=t[1],i.r.f=t[2],n.y(1)}),s=n.m(1).then(function(t){s=t}))},g:function(t){var i,n=this;return null==s&&this.v(),s instanceof Promise?s.then(function(){return n.g(t)}):void 0!==(i=s[t])?i:this.p[t]},k:function(t,e){var r,u;return u=e,void 0!==(r=i.r.p[t])&&("object"==typeof r?JSON.stringify(e)===JSON.stringify(r):e===r)&&(u=null),n.m(2,{key:t,val:u}).then(function(i){s[t]=null!==i?i:e})},b:{__proto__:null,filterLinkHints:"f",ignoreCapsLock:"i",ignoreKeyboardLayout:"l",mapModifier:"a",mouseReachable:"e",keyboard:"k",keyupTime:"u",linkHintCharacters:"c",linkHintNumbers:"n",passEsc:"p",regexFindMode:"r",smoothScroll:"s",scrollStepSize:"t",waitForEnter:"w"}},r=(function(){function t(t,n){var e=t.id;this.x=e,this.S=t,this.w=this.N=null,this.O=false,e in i.r.b?n=this.P.bind(this,n):"autoDarkMode"!==e&&"autoReduceMotion"!==e||(n=this.z.bind(this,n)),this.N=i.h(n,330,this,1),this.J(t)}return t.prototype.M=function(){},t.prototype.R=function(){var i,e=this;if(this.O=true,(i=this.C())instanceof Promise)return i.then(t.prototype.R.bind(this));this.w=i,t.T||n.K(function(){e.j(e.w)})},t.prototype.C=function(){return i.r.g(this.x)},t.prototype.D=function(t){var i=this.H;return i?i.L(t):t},t.prototype.A=function(){return true},t.prototype.E=function(){return __awaiter(this,void 0,void 0,function*(){var t,i=this,e=this.F(),s="object"==typeof e,r=s?JSON.stringify(this.w):this.w,u=s?JSON.stringify(e):e;if(u!==r)return r=u,e=(t=this.D(e))instanceof Promise?yield t:t,e=yield this.Z(e),this.w=e,this.O=true,(r!==(s?JSON.stringify(e):e)||this.q(e))&&n.K(function(){i.j(i.w,true)}),this.M()})},t.prototype.B=function(){var t=this.C(),i=!this.G(this.w,t);return i&&this.G(this.F(),t)?(this.w=t,this.O=true,false):i},t.prototype.Z=function(n){return __awaiter(this,void 0,void 0,function*(){return yield i.r.k(this.x,n),this.x in i.r.b&&t.I.push(this.x),this.C()})},t.prototype.q=function(){return false},t.Q=function(t,i){return JSON.stringify(t)===JSON.stringify(i)},t.T=false,t})(),i.s=r,u=(function(t){function e(){var i=null!==t&&t.apply(this,arguments)||this;return i.G=r.Q,i}return __extends(e,t),e.prototype.J=function(t){var i=this;this.U=t.querySelector("#exclusionTemplate").content.querySelector(".exclusionRule"),this.V=t.querySelector("tbody"),this.W=[],this.V.addEventListener("input",e.X),this.V.addEventListener("input",this.N),this.V.addEventListener("click",function(t){return i.Y(t)}),this.tt=false,n.$("#exclusionAddButton").onclick=function(){return i.it("")}},e.prototype.nt=function(){},e.X=function(t){var i=t.target,n=i.vnode;n&&(n.et|=i.classList.contains("pattern")?1:2)},e.prototype.it=function(t,i){this.st(this.V,{pattern:t,passKeys:""});var e=this.W[this.W.length-1];false!==i&&n.K(function(){return e.rt.focus()}),t&&this.N(),this.nt(1)},e.prototype.j=function(t){var i,e,s;if(!this.tt)for(i of(this.tt=true,r.I&&(this.U.draggable=true),"en"!==n.a?n.$$("[title]",this.U):[]))(e=n.c(i.title))&&(i.title=e);return this.V.textContent="",this.W=[],t.length<=0||(1===t.length?this.st(this.V,t[0]):(s=document.createDocumentFragment(),t.forEach(this.st.bind(this,s)),this.V.appendChild(s))),this.nt(t.length)},e.prototype.ut=function(){return true},e.prototype.st=function(t,i){var n,e,s,r,u,o=i.pattern,h=i.passKeys,a={ot:{pattern:o,passKeys:h},ht:null,et:0,at:false,rt:null,ct:null};a.at=this.ut(a),a.at?(e=(n=document.importNode(this.U,true)).querySelector(".pattern"),s=n.querySelector(".passKeys"),r=h.trimRight(),e.value=o,o&&(e.placeholder=""),s.value=r,r&&(s.placeholder=""),(u=a).rt=e,u.ct=s,e.vnode=u,s.vnode=u,this.W.push(u),t.appendChild(n)):this.W.push(a)},e.ft=function(t){t.ot.pattern&&t.ct.placeholder&&(t.ct.placeholder="")},e.prototype.Y=function(t){var i,n=t.target;if("path"===n.localName&&(n=n.parentElement),"svg"===n.localName&&(n=n.parentElement),n.classList.contains("remove"))return(n=n.parentNode.parentNode).classList.contains("exclusionRule")?(i=n.querySelector(".pattern").vnode,n.remove(),this.W.splice(this.W.indexOf(i),1),this.N(),this.nt(0)):void 0},e.lt=function(t,i,n){var e=n.toLowerCase();return i||1!==n.length?n!==e?"<".concat(i,"s-").concat(e,">"):t:n},e.pt=function(t){return t&&t.replace(/<(?!<)((?:[acm]-){0,3})(\S|[A-Za-z]\w+)>/g,e.lt)},e.prototype.F=function(t){var n,s,r,u,h,a,c,f,l,p,d,v=[];for(n of(t=true===t,this.W))t&&!n.at||((s=n.et)?(r=1&s?n.rt.value.trim():n.ot.pattern,u=false,h=2&s?n.ct.value:n.ot.passKeys,r?(1&s&&((a=r.startsWith(":")?0:r.indexOf("://"))&&(/^[\^*]|[^\\][$()*+?\[\]{|}]/.test(r)?r.startsWith("`")||(r.startsWith("^")?(f=".*$".includes(r.slice(-2))?r.endsWith(".*$")?3:r.endsWith(".*")?2:0:0,r=0!==f&&"\\"!==r[r.length-f]?r.slice(0,-f):r):(u=!r.includes("/",a+3),r.endsWith("*")&&(r=r.slice(0,/^[^\\]\.\*$/.test(r.slice(-3))?-2:-1),u=false),c=(a<0?"^https?://":"^")+((c=r=r.startsWith(".*")&&!/[(\\[]/.test(r)?"*."+r.slice(2):r).startsWith("*")&&"."!==c[1]?"[^/]"+c:(c=c.replace(/\./g,"\\.")).startsWith("*")?c.replace("*\\.","(?:[^./]+\\.)*?"):c.replace("://*\\.","://(?:[^./]+\\.)*?")),r=o(c,"")?c:r.includes("*")||r.includes("/")?":"+r:":https://"+(r.startsWith(".")?r.slice(1):r))):(u=!r.includes("/",a+3)&&!r.startsWith("vimium:"),r=(a<0?":http://":":")+(r=r.replace(/\\(.)/g,"$1")))),u&&(r+="/")),2&s&&h&&((l=(h=e.pt(h)).match(/<(?!<)(?:a-)?(?:c-)?(?:m-)?(?:s-)?(?:[a-z]\w+|[^\sA-Z])>|\S/g))&&((p="^"===l[0]&&l.length>1)&&l.shift(),l.sort(),p?l.unshift("^"):"^"===l[0]&&(l.shift(),l.push("^"))),h=(h=l?l.join(" ")+" ":"").replace(/<escape>/gi,"<esc>")),d=h?h.length>1&&"^"===h[0]?i.t("onlyHook")||"only hook such keys":i.t("passThrough")||"pass through such keys":i.t("completelyDisabled")||"completely disabled",n.rt.title!==r&&(n.rt.title=r),n.ct.title!==d&&(n.ct.title=d),this.dt(n,r,h),v.push(n.ot)):(n.rt.title&&(n.rt.title=""),n.ct.title&&(n.ct.title=""),this.dt(n,"",h))):n.ot.pattern&&v.push(n.ot));return v},e.prototype.dt=function(t,i,n){var s=!t.ot.passKeys&&!!n;t.ot={pattern:i,passKeys:n},t.ht=null,t.et=0,s&&e.ft(t)},e.prototype.M=function(){var t,i;for(t of this.W)t.at&&(t.rt.value!==t.ot.pattern&&(t.rt.value=t.ot.pattern),i=t.ot.passKeys.trim(),t.ct.value!==i&&(t.ct.value=i))},e})(r),i.e=u,o=function(t,i){try{return new RegExp(t,i)}catch(t){return null}},i.n=n.vt<48||devicePixelRatio<2&&n.vt>=61?function(){var t=document.createElement("style"),i=devicePixelRatio,e=n.vt>=61&&i>=1,s=e||n.vt>=48?1/i:1;s=(""+(s+=999e-8)).slice(0,7).replace(/\.?0+$/,""),t.textContent=e?"html { --tiny: ".concat(s,"px; }"):"* { border-width: ".concat(s,"px !important; }"),document.head.appendChild(t)}:null,i.t=function(t,i){return n.c(t,i)||""}});