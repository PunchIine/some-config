"use strict";__filename="pages/options_permissions.js",define(["require","exports","./async_bg","./options_base","./options_defs"],function(n,o,e,r,i){var t,s,u,f,c,a,l,m,d,p,v,h,_,g,w,P,b,O,C;if(Object.defineProperty(o,"__esModule",{value:true}),o.rn=o.manifest=void 0,s=e.Mt.permissions,u=function(n){if(!s)return function(){return e.m(25,{module:"permissions",name:n,args:[].slice.call(arguments)})};var o=s[n];return function(){var n=[].slice.call(arguments);return new Promise(function(r){n.push(function(n){var o=e.Mt.runtime.lastError;return r(o?[void 0,o]:[n,void 0]),o}),o.apply(s,n)})}},f={contains:u("contains"),request:u("request"),remove:u("remove")},c="downloads.shelf",a="chrome://new-tab-page/*",(t={})[l="chrome://*/*"]="opt_chromeUrl",t[a]="opt_cNewtab",t[c]="opt_closeShelf",m=t,d=e.$("#optionalPermissionsTemplate"),p=d.content.firstElementChild,v=d.parentElement,h=[],o.manifest=e.Mt.runtime.getManifest(),_=o.manifest.optional_permissions||[],g=(function(n){function o(){var o=null!==n&&n.apply(this,arguments)||this;return o.F=function(){return h.map(function(n){return n.S.checked?n.S.indeterminate?"1":"2":"0"}).join("")},o.C=function(){return h.map(function(n){return n.w}).join("")},o}return __extends(o,n),o.prototype.J=function(){this.S.onchange=this.N},o.prototype.j=function(n){for(var o=0;o<h.length;o++)h[o].S.checked="0"!==n[o],h[o].S.indeterminate="1"===n[o]},o.prototype.Z=function(n){var o,t,s,u=this,m=[],d=[],p={},v=1,_=function(o){var e,t=h[o],u=+n[o];if(t.w===u)return"continue";e=t.in===a?"chrome://newtab/*":"",t.w=u,t.in===l&&r.r.g("allBrowserUrls")!==(2===u)&&r.r.k("allBrowserUrls",2===u),u?(t.in===c&&m.push("downloads"),(t.in.includes(":")?d:m).push(t.in),e&&d.push(e),p[t.in]=t):(v++,f.remove(t.in.includes(":")?{origins:e?[t.in,e]:[t.in]}:{permissions:t.in===c?["downloads",t.in]:[t.in]}).then(function(n){var o,e=n[1],r="Can not remove the permission %o :",u=e&&e.message||e;(e||!n[0])&&console.log(r,t.in,u),o=t.S.parentElement,i.Ot.zt(e?r.replace("%o",t.in)+u:"",void 0,o),s()}))};for(o=0;o<h.length;o++)_(o);return t=function(n,o){var t,f,c,a=o[0],l=o[1];if((l||!a)&&console.log("Can not request permissions of %o :",n,l&&l.message||l),!a){for(f of(t=function(n){var o,t,s=p[n];return s?(s.w=0,o=s.S.parentElement,l?(t=(l&&l.message||JSON.stringify(l))+"",n.startsWith("chrome://")&&t.includes("Only permissions specified in the manifest")&&n.startsWith("chrome:")&&(t=r.t("optNeedChromeUrlFirst"),t=e.sn?t.replace("chrome:","edge:"):t),t=r.t("exc")+t,i.Ot.zt(t,void 0,o),void e.K(function(){o.title=t})):{value:i.Ot.zt("",void 0,o)}):"continue"},n))if("object"==typeof(c=t(f)))return c.value;u.R()}s()},s=function(){--v>0||Promise.all(h.map(P)).then(function(){u.R()})},v+=(m.length&&1)+(d.length&&1),m.length&&f.request({permissions:m}).then(t.bind(0,m)),d.length&&f.request({origins:d}).then(t.bind(0,d)),s(),Promise.resolve(n)},o})(r.s),o.rn=g,i.registerClass("OptionalPermissions",g),w=function(){var n,o,i,t,s,u,f,c=document.createDocumentFragment();for(o of(n=0,_))t=(i=document.importNode(p,true)).querySelector("input"),s=m[o],t.value=o,u=r.t(s||"opt_".concat(o))||o,f="",o.startsWith("chrome:")&&(u=e.sn?u.replace("chrome:","edge:"):u,f=r.t("optOfChromeUrl").replace(e.sn?"chrome":"edge","edge")),o===a&&e.vt<80&&(f=r.t("requireChromium",[80]),t.disabled=true,t.checked=false,i.title=r.t("invalidOption",[r.t("beforeChromium",[80])])),i.lastElementChild.textContent=u+f,1===_.length&&i.classList.add("single"),c.appendChild(i),h[n++].S=t;v.appendChild(c),v.addEventListener("change",b,true)},P=function(n){var o,i=n.in,t=new Promise(function(n){o=n});return f.contains(i.includes(":")?{origins:[i]}:{permissions:i===c?["downloads",i]:[i]}).then(function(t){var s,u=t[0];e.vt<72&&i===a&&(u=false),s=u?n.in!==l||r.r.g("allBrowserUrls")?2:1:0,n.w=s,o()}),t},b=function(n){var o,e,r,i,t=n.target,s=h.find(function(n){return n.S===t});s&&(o=t.checked,s.in!==l&&s.in!==a||(r=(e=s.in===a)?l:a,(i=h.find(function(n){return n.in===r}))&&(e&&o&&!i.S.checked?i.S.checked=i.S.indeterminate=true:!e&&o&&t.indeterminate?t.indeterminate=false:(i.S.checked=o,i.S.indeterminate=false))))},O=["downloads"],!e.sn||O.push(a),O.push("cookies"),(_=_.filter(function(n){return!O.some(function(o){return"string"==typeof o?n===o:o.test(n)})})).length){for(C of _)h.push({in:C,w:0,S:null});e.K(w),Promise.all(h.map(P)).then(function(){e.K(function(){v.dataset.model="OptionalPermissions",i.createNewOption(v).R()})})}else e.K(function(){e.$("#optionalPermissionsBox").style.display="none"})});